@{
	_Layout = "Layout.htm";
	ViewBag.Title = @Model.Name;
}

<link type="text/css" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.21/themes/ui-lightness/jquery-ui.css" rel="Stylesheet" />
<link type="text/css" href="@(Model.CSSUrl)poi.css" rel="Stylesheet" />

<script src = "@(Model.ScriptUrl)jquery-1.6.4.min.js" type = "text/javascript"></script>
<script src = "@(Model.ScriptUrl)jquery.signalR-0.5.2.min.js" type ="text/javascript"></script>
<script src = "@(Model.SignalrUrl)hubs" type="text/javascript"></script>
<script src = "@(Model.ScriptUrl)jquery-ui-1.8.22.custom.min.js" type="text/javascript"></script>
<script src = "@(Model.ScriptUrl)jquery.corner.js" type="text/javascript"></script>
<script src = "@(Model.ScriptUrl)jquery.ui.touch-punch.min.js" type="text/javascript"></script>
<script src ="http://localhost/index.cshtml/poilib.js" type="text/javascript"></script>


<!--Initialization routines-->
<script type = "text/jscript">
	$(document).ready(function () {
		$.connection.hub.url = '@Model.SignalrUrl';
		poiProxy = $.connection.proxyHub;

		//Initialize the callback function for the hub
		poiProxy.echoOnClient = function () {
			//alert("LZ SB!!!");
		}

		//Register handlers
		poiProxy.handlePresInfo = handlePresInfo;
		poiProxy.handleMetadataArchive = handleMetadataArchive;

		poiProxy.handlePresCtrlMsg = handlePresCtrlMsg;
		poiProxy.handleWhiteboardMsg = handleWhiteboardMsg;
		poiProxy.handleCommentMsg = handleCommentMsg;
		poiProxy.handlePtrCtrlMsg = handlePtrCtrlMsg;

		poiProxy.scheduleMsgHandling = scheduleMsgHandling;
		poiProxy.setAudioSyncReference = setAudioSyncReference;

		poiProxy.getSlide = getSlide;
		poiProxy.startPresentation = startPresentation;
		

		//Connect to the hub
		$.connection.hub.start().done(function () {
			//alert("Start done!");
			poiProxy.echoOnServer();
			poiProxy.joinSession(@(Model.ContentId), @(Model.SessionId));
		});

		

		$("#PresBoard").css({
			"background-image": "url(@(Model.ImageUrl)background_mini.png)",
			"background-repeat": "repeat"
		});
		//$("#PresBoard").resizable().draggable();

		
		initSideBarSliding();
		initMainContentSliding();
        //initVideoTesting();
        initAudioStreamingPlayer();
		initMainSlideViewClicking();

		//$("#PresBoardSideBarSlideRegion").slider("disable");

		
		updateUI();
		initMenuBar();
        initFootBar();
		initDrawing();
		initLaserPointerLayer();

        //$("#whiteBoard").hide();

	});

 

    function initAudioStreamingPlayer() {
        
        //$("#AudioStreamingPlayer > audio").attr('src', "http://192.168.0.100/3/audio/1/POIAudio.m3u8");
        $("#AudioStreamingPlayer > audio").attr('src', "http://192.168.0.100/3/audio/1/Final.wav");
        //$("#AudioStreamingPlayer > audio").attr('src', "http://192.168.0.100:8090/test.webm");

        $("#AudioStreamingPlayer > audio").bind('timeupdate', function(){
            var audioPlayer = $("#AudioStreamingPlayer > audio")[0];
            //poiProxy.log('audio current time: ' + audioPlayer.currentTime);
        });
    }

    function initVideoTesting(url) {
        
        $(".MainAnimationView").remove();

        var myVideo = $('<video></video>',{
            class : 'MainAnimationView',
        });

        var videoSrc = $('<source>');
        videoSrc.attr('src', url);
        videoSrc.attr('type', 'video/mp4');

        myVideo.append(videoSrc);

        myVideo.css({
            width: "98%",
            height: "98%",
            top: "1%",
            left: "1%",
            position: "absolute"
        });

        $("#PresBoardMainDisplay").append(myVideo);
        
    }
    
	function initSideBarSliding() {
		$("#PresBoardSideBarSlideRegion").slider({
			orientation: "vertical",
			slide: duringSlideOnSideBar,
			start: startSlide,
			stop: stopSlideSideBar
		});

		$(".ui-slider-handle").hide();
	}


	function initMainContentSliding() {
		$("#MainContentSlideRegion").slider({
			orientation: "horizontal",
			slide: duringSlideOnMainContent,
			start: startSlideMainContent,
			stop: stopSlideMainContent
		});

		$(".ui-slider-handle").hide();
	}

    function initMainSlideViewClicking(){
        $('#PresBoardMainDisplay').click(function(){
            presentationNext();
        });
    }


	function updateUI() {
		// Apple detection object  
		var Apple = {};
		Apple.UA = navigator.userAgent;
		Apple.Device = false;
		Apple.Types = ["iPhone", "iPod", "iPad"];
		for (var d = 0; d < Apple.Types.length; d++) {
			var t = Apple.Types[d];
			Apple[t] = !!Apple.UA.match(new RegExp(t, "i"));
			Apple.Device = Apple.Device || Apple[t];
		}

		if (Apple.iPad) {
			initIpadLayout();
		}
		else {
			initCommonLayout();
		}
	}

	function initCommonLayout() {
		var board = $("#PresBoard");
		var totalWidth = board.width();
		var myHeight = parseInt((totalWidth) / 100 * 75);

		board.css({
			height: myHeight
		});
	}

	function initIpadLayout() {
		$("#PresBoard").css({
			width: "100%",
			left: "0%",
			top: "0%",
		});

		$("#PresBoard").css("border-radius", 0);

		var board = $("#PresBoard");
		var totalWidth = board.width();
		var myHeight = parseInt((totalWidth) / 100 * 74);

		board.css({
			height: myHeight
		});
	}

	function initLaserPointerLayer() {
		//Set the src for the laser pointer
		$("#laserPointer").attr("src", "@(Model.ImageUrl)laser.png");
		ptrController.HidePointer();
	}

	function initMenuBar() {
		$("#DrawingItem > img").attr("src", "@(Model.ImageUrl)pencil.png");
		$("#PointerItem > img").attr("src", "@(Model.ImageUrl)laser_icon.jpg");
		$("#CommentItem > img").attr("src", "@(Model.ImageUrl)speech_bubble.png");
		$("#MailItem > img").attr("src", "@(Model.ImageUrl)mail.png");
        $("#RecordItem > img").attr("src", "@(Model.ImageUrl)record-icon.png");
        $("#FullscreenButton > img").attr("src", "@(Model.ImageUrl)fullscreen-button.png");
		$("#Logo > img").attr("src", "@(Model.ImageUrl)logo.png");

        $("#FullscreenButton").css("border", "none");

		$("#DrawingItem > img").click(function(){
			if(!whiteboardEnabled) {
				showWhiteboard();
				drawingTool.switchToDrawingMode();
			}
			else {
				hideWhiteboard();
			}
			
		});

		 $("#PointerItem > img").click(function(){
		   
			showWhiteboard();
			drawingTool.switchToPointerMode();
			
		});

		$("#CommentItem > img").click(function(){

			showWhiteboard();
			drawingTool.switchToTextMode();
		});

		$("#MailItem > img").click(function(){
			//Save the current drawing
			drawingTool.saveComment();
            updateNumCommentsLabel();

			alert("Comment has been sent!");
			hideWhiteboard();
		});

		$("#Logo").css("cursor", "hand");

		$("#Logo > img").click(function(){
			window.location.href = "http://www.pipeofinsight.com";
            //seekToPosition();
		});

		$("#RecordItem > img").click(function(){
		    contentPlayer.playFromSlideIndex(curSlideIndex);
		});

		$('#replayImg').click(function(){
		    alert("Hey");
		});

		$('.circle').click(function(){
		    alert("circle");
		});
	}

    function initFootBar() {
        var myWidth = $("#FootBarContainer").width();
        $("#FootBarContainer").css({
            height: myWidth + "px"
        });
        
        $("#CommentsLabel").attr("src", "@(Model.ImageUrl)pencil-1.png");
        $("#NumCommentsLabelContainer > img").attr("src", "@(Model.ImageUrl)circle.png");
        $("#FootBarContainer").click(function(){
            alert("Drag the slide to the left to see the comments");
        });
        updateNumCommentsLabel();
    }

</script>
    


<!--Global variables definition-->
<script type="text/javascript">
	//Global variables definitions

	//Variable for connecting to POI Proxy
	var poiProxy;

	// The pencil tool instance.
	var drawingTool = new tool_pencil("#canvasStack");

	// The laser pointer controller
	var ptrController = new LaserPointerController();

	//For slider region control
	var isStart = false;
	var startValue;
	var curTransformValueSideBar = 0;
	var curTransformValueMainContent = 0;
	var startingTransformValueMainContent = 0;

	//For showing presentation
	var curPresentation;
	var curSlideList;
	var curPresInfo;

	var curPlayedTime = 0;
	var curSlideIndex = 0;
	var curDurationIndex = -1;
	var preloadSlideIndex = 0; //The next slide to be preloaded
	var mainSlideViewIndex = 2;
	var initialPreloadSlideCount = 5;

	//For comments storage
	var myStorage = new storageTool();
	var showPublicComment = false;

	//For whiteboard control
	var whiteboardEnabled = false;

    //For audio and metadata synchronization
	var audioStartingTime = 0.0;
	var audioSyncMode = 0;
	var lastSyncTime = 0.0;

    //For content replay
	var contentPlayer;
	var contentPlaySeqNum = 0;

    //For js
	var ImageUrl = "@(Model.ImageUrl)";
    var ContentServerUrl = "@(Model.ContentServerUrl)";
</script>